<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width initial-scale=1" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>Testing Rules</title>
    <meta name="description" content="TSLint documentation. A linter for the TypeScript language.
">

    <link rel="stylesheet" href="/tslint/css/main.css">
    <link rel="canonical" href="http://localhost:4000/tslint/develop/testing-rules/">
</head>


  <body>

    

<header class="header">
  <section class="site-header">
      <a class="site-title" href="/tslint/">TSLint</a>
      <nav class="site-nav">
        <a class="page-link" href="/tslint/usage/cli">Usage</a>
        <a class="page-link" href="/tslint/rules">Rules</a>
        <a class="page-link" href="/tslint/formatters">Formatters</a>
        <a class="page-link" href="/tslint/develop/custom-rules">Develop</a>
        <a class="page-link" href="/tslint/news">News</a>
      </nav>
  </section>
  
</header>


    <div class="main-content">
        <div class="page">
   <article class="page-content">
      
      <header class="post-header">
         <h1 class="post-title">Testing Rules</h1>
         <p></p>
      </header>
      

      <p>Every TSLint rule has a corresponding directory inside <code class="highlighter-rouge">test/rules/</code> which contains one or more test cases for the rule.</p>

<p>Each test case contains:</p>

<ul>
  <li>A <code class="highlighter-rouge">tslint.json</code> file which specifies the configuration for TSLint to use</li>
  <li><code class="highlighter-rouge">.ts.lint</code> test files which contain TypeScript code and a special markup which indicate where lint failures should be found</li>
</ul>

<p>The test system lints the <code class="highlighter-rouge">.ts.lint</code> files with the settings specified in <code class="highlighter-rouge">tslint.json</code> and makes sure that failures generated by the TSLint match the failures marked in the <code class="highlighter-rouge">.ts.lint</code> files.</p>

<h3 id="example">Example</h3>

<h5 id="testing-a-new-rule">Testing a New Rule</h5>

<p>Say we’re contributing a new rule to TSLint that bans the use of animal variable names and we now need to test it. First we create our configuration file which enables only the rule to be tested:</p>

<p><code class="highlighter-rouge">test/rules/no-animal-variable-names/default/tslint.json</code>:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{
  "rules": {
    "no-animal-variable-names": true
  }
}
</code></pre></div></div>

<p>In this case, we placed our configuration inside <code class="highlighter-rouge">no-animal-variable-names/default</code> to indicate that we’re testing the default configuration for our rule.</p>

<p>Now let’s make the actual test file:</p>

<p><code class="highlighter-rouge">test/rules/no-animal-variable-names/default/test.ts.lint</code>:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>const octopus = 5;
      ~~~~~~~      [Variables named after animals are not allowed!]

let giraffe: number, tiger: number;
    ~~~~~~~                 [Variables named after animals are not allowed!]
                     ~~~~~  [Variables named after animals are not allowed!]

const tree = 5;
const skyscraper = 100;
</code></pre></div></div>

<p>In the above file, <code class="highlighter-rouge">~</code> characters “underline” where our rule should generate a lint failure
and the message that should be produced appears in brackets afterwards.</p>

<p>If multiple lint failures occur on the same line of TypeScript code, the markup for them is placed on consecutive lines,
as shown in the above example with the line <code class="highlighter-rouge">let giraffe: number, tiger: number;</code></p>

<p>Notice how we also include lines of code that <em>shouldn’t</em> generate lint failures.
This is important to ensure that the rule isn’t creating false-positives.</p>

<p>We can now run <code class="highlighter-rouge">yarn compile:test &amp;&amp; yarn test:rules</code> to make sure that our rule produces the output we expect.</p>

<h5 id="testing-a-new-rule-option">Testing a New Rule Option</h5>

<p>Let’s look at one more example. Say we’ve added an <code class="highlighter-rouge">also-no-plants</code> option to our rule above that disallows variable names that are plants. We should add a test for this new option:</p>

<p><code class="highlighter-rouge">test/rules/no-animal-variable-names/also-no-plants/tslint.json</code>:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{
  "rules": {
    "no-animal-variable-names": [true, "also-no-plants"]
  }
}
</code></pre></div></div>

<p><code class="highlighter-rouge">test/rules/no-animal-variable-names/also-no-plants/test.ts.lint</code>:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>const octopus = 5;
      ~~~~~~~     [no-animal]

let giraffe: number, tiger: number;
    ~~~~~~~                 [no-animal]
                     ~~~~~  [no-animal]

const tree = 5;
      ~~~~      [no-plant]
const skyscraper = 100;

[no-animal]: Variables named after animals are not allowed!
[no-plant]: Variables named after plants are not allowed!
</code></pre></div></div>

<p>We’ve now used a special message shorthand syntax so we don’t have to type out the same failure message over and over.
Instead of writing out the full lint failure message after each occurance of it, we instead just specify a shortcut name.
(Shortcut names can only consist of letters, numbers, underscores, and hyphens.)
Then, at the bottom of our test file, we specify what full message each shortcut should expand to.</p>

<p>Again, we can run <code class="highlighter-rouge">yarn compile:test &amp;&amp; yarn test:rules</code> to make sure our rule is producing the output we expect. If it isn’t we’ll see the difference between the output from the rule and the output we marked.</p>

<p>You can also use placeholders to format messages. That’s useful if the error message contains non-static parts, e.g. variable names. But let’s stick to the above example for now.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>const octopus = 5;
      ~~~~~~~     [no-animal]

let giraffe: number, tiger: number;
    ~~~~~~~                 [no-animal]
                     ~~~~~  [no-animal]

const tree = 5;
      ~~~~      [error % ("plants")]
const skyscraper = 100;

[error] Variables named after %s are not allowed!
[no-animal]: error % ('animals')
</code></pre></div></div>

<p>We created a message template called <code class="highlighter-rouge">error</code> which has one placeholder <code class="highlighter-rouge">%s</code>. For a complete list of supported placeholders, please refer to the documentation of node’s <a href="https://nodejs.org/api/util.html#util_util_format_format_args">util.format()</a>.
To use the template for formatting, you need to use a special syntax: <code class="highlighter-rouge">template_name % ('substitution1' [, "substitution2" [, ...]])</code>.
Substitutions are passed as comma separated list of javascript string literals. The strings need to be wrapped in single or double quotes. Escaping characters works like you would expect in javascript.</p>

<p>You may have noticed that the template is used for formatting in two different places. Use it in inline errors to pass another substitution every time.
If you use formatting in another message shorthand (like we did for <code class="highlighter-rouge">[no-animal]</code>), you need to make sure the template is defined before its use. That means swapping the lines of <code class="highlighter-rouge">[error]</code> and <code class="highlighter-rouge">[no-animal]</code> will not work. There are no restrictions for the use of <code class="highlighter-rouge">[no-animal]</code> in inline errors, though.</p>

<p>Now let’s pretend the rule changed its error message to include the variable name at the end. The following example shows how to substitute multiple placeholders.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>const octopus = 5;
      ~~~~~~~     [no-animal % ('octopus')]

let giraffe: number, tiger: number;
    ~~~~~~~                 [no-animal % ('giraffe')]
                     ~~~~~  [no-animal % ('tiger')]

const tree = 5;
      ~~~~      [error % ("plants", "tree")]
const skyscraper = 100;

[error] Variables named after %s are not allowed: '%s'
[no-animal]: error % ('animals')
</code></pre></div></div>

<h5 id="typescript-version-requirement">Typescript version requirement</h5>

<p>Sometimes a rule requires a minimum version of the typescript compiler or your test contains syntax that older versions of the typescript parser cannot handle.
When testing with multiple versions of typescript - like <code class="highlighter-rouge">tslint</code> does in CI - those tests will fail.</p>

<p>To avoid failing tests, each test file can specify a version requirement for typescript <strong>in the first line</strong>. If you don’t specify one, the test will always be executed.</p>

<p>Example:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[typescript]: &gt;= 2.1.0
</code></pre></div></div>

<p>The syntax should look familiar, because it is basically the shorthand syntax from the chapter above. It needs to start with <code class="highlighter-rouge">[typescript]:</code>.
The following part can be any <a href="https://github.com/npm/node-semver#ranges">version range</a>. The prerelease suffix will be removed before matching to allow testing with nightly builds.</p>

<h3 id="tips--tricks">Tips &amp; Tricks</h3>

<ul>
  <li>
    <p>You can use this system to test rules outside of the TSLint build! Use the <code class="highlighter-rouge">tslint --test path/to/dir</code> command to test your own custom rules.
You can specify one or more paths to <code class="highlighter-rouge">tslint.json</code> files or directories containing a <code class="highlighter-rouge">tslint.json</code>. Glob patterns are also supported.
Besides the <code class="highlighter-rouge">tslint.json</code> each directory you pass should contain <code class="highlighter-rouge">*.ts.lint</code> files. You can try this out on the TSLint rule test cases, for example, <code class="highlighter-rouge">tslint --test path/to/tslint-code/test/rules/quotemark/single</code>.
If you want to test all of your rules at once, you can use it like this: <code class="highlighter-rouge">tslint --test rules/test/**/tslint.json</code></p>
  </li>
  <li>
    <p>To test rules that need type information, you can simply add a <code class="highlighter-rouge">tsconfig.json</code> with the desired configuration next to <code class="highlighter-rouge">tslint.json</code>.</p>
  </li>
  <li>
    <p>Lint failures sometimes span over multiple lines. To handle this case, don’t specify a message until the end of the error. For example:</p>
  </li>
</ul>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>for (let key in obj) {
~~~~~~~~~~~~~~~~~~~~~~
  console.log(key);
~~~~~~~~~~~~~~~~~~~
}
~ [for-in loops are not allowed]
</code></pre></div></div>

<ul>
  <li>If for some reason your lint rule generates a failure that has zero width, you can use the <code class="highlighter-rouge">~nil</code> mark to indicate this.</li>
</ul>


   </article>
   <section class="page-sidebar">
      

      
      

      
      

      
         
<h4 class="sidebar-title">Develop</h4>
<ul class="sidebar-links">
   
      
      
      <li><h6 class=""><a href="/tslint/develop/custom-rules/">Custom Rules</a></h6></li>
   
      
      
      <li><h6 class=""><a href="/tslint/develop/custom-rules/performance-tips.html">Performance Tips</a></h6></li>
   
      
      
      <li><h6 class=""><a href="/tslint/develop/custom-rules/walker-design.html">Walker Design</a></h6></li>
   
      
      
      <li><h6 class=""><a href="/tslint/develop/custom-formatters/">Custom Formatters</a></h6></li>
   
      
      
      <li><h6 class=""><a href="/tslint/develop/contributing/">Contributing</a></h6></li>
   
      
      
      <li><h6 class=""><a href="/tslint/develop/docs/">Docs Development</a></h6></li>
   
      
      
      <li><h6 class=""><a href="/tslint/develop/testing-rules">Testing Rules</a></h6></li>
   
</ul>

      
   </section>

</div>

        <footer class="site-footer">
  <div class="footer-col-wrapper">
    <div class="footer-col  footer-col-1">
      <ul class="contact-list">
        <li>©2016 Palantir Technologies under <a href="https://github.com/palantir/tslint/blob/master/LICENSE">Apache 2.0</a></li>
        <li>Styles based off of the <a href="https://github.com/jasonlong/cayman-theme">Cayman Theme</a> by Jason Long.
        <li>Issues? <a href="https://github.com/palantir/tslint">Let us know on GitHub.</a></li>
      </ul>
    </div>

    <div class="footer-col  footer-col-2">
      <ul class="social-media-list">
        
        <li>
          <a href="https://github.com/palantir/tslint">
            <span class="icon  icon--github">
              <svg viewBox="0 0 16 16">
                <path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/>
              </svg>
            </span>

            <span class="username">palantir/tslint</span>
          </a>
        </li>
        

        
        <li>
          <a href="https://twitter.com/PalantirTech">
            <span class="icon  icon--twitter">
              <svg viewBox="0 0 16 16">
                <path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809
                c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/>
              </svg>
            </span>

            <span class="username">PalantirTech</span>
          </a>
        </li>
        
      </ul>
    </div>
  </div>
</footer>

    </div>

  </body>

</html>
